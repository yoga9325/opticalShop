<header class="app-header shadow-sm">
    <div class="app-container d-flex align-items-center justify-content-between py-2">
        <div class="d-flex align-items-center gap-3">
            <div class="brand fw-bold">
                <img src="assets/logo.jpg" alt="Optical Shop" height="80">
            </div>
        </div>

        <div class="d-flex align-items-center gap-3">
            <nav class="d-flex align-items-center gap-3">
                <a routerLink="/" class="text-decoration-none text-dark">Home</a>
                <a routerLink="/products" class="text-decoration-none text-dark">Products</a>
                <a routerLink="/about" class="text-decoration-none text-dark">About</a>
                <a routerLink="/contact" class="text-decoration-none text-dark">Contact</a>

                <!-- Book Appointment CTA -->
                <a routerLink="/appointment" class="btn-cta">
                    <i class="bi bi-calendar-check-fill me-1"></i> Book Eye Test
                </a>

                <!-- Admin Link -->
                <a *ngIf="isAdmin()" routerLink="/admin" class="text-decoration-none text-dark">Admin</a>

                <!-- User Dropdown (Logged In) -->
                <div class="nav-item dropdown" *ngIf="auth.isLoggedIn()">
                    <a class="nav-link dropdown-toggle text-dark d-flex align-items-center gap-2" href="#" role="button"
                        (click)="toggleDropdown($event)" [class.show]="isDropdownOpen" aria-expanded="false">
                        <div class="user-avatar">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        <span>Account</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0" [class.show]="isDropdownOpen"
                        (click)="$event.stopPropagation()">
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2" routerLink="/profile"
                                (click)="isDropdownOpen = false">
                                <i class="bi bi-person"></i> Profile
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2" routerLink="/order-history"
                                (click)="isDropdownOpen = false">
                                <i class="bi bi-box-seam"></i> My Orders
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2 justify-content-between cursor-pointer"
                                (click)="handleProtectedNavigation('/my-appointments'); isDropdownOpen = false">
                                <span><i class="bi bi-calendar-check"></i> My Appointments</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2 justify-content-between cursor-pointer"
                                (click)="handleProtectedNavigation('/my-prescriptions'); isDropdownOpen = false">
                                <span><i class="bi bi-file-medical"></i> My Prescriptions</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2 justify-content-between cursor-pointer"
                                (click)="handleProtectedNavigation('/wishlist'); isDropdownOpen = false">
                                <span><i class="bi bi-heart"></i> Wishlist</span>
                                <span *ngIf="(wishlistCount$ | async) as count" class="badge bg-danger rounded-pill"
                                    [hidden]="count === 0">{{ count }}</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2 justify-content-between cursor-pointer"
                                (click)="handleProtectedNavigation('/cart'); isDropdownOpen = false">
                                <span><i class="bi bi-cart"></i> Cart</span>
                                <span *ngIf="(cartCount$ | async) as count" class="badge bg-danger rounded-pill"
                                    [hidden]="count === 0">{{ count }}</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2 text-danger" (click)="logout()"
                                style="cursor: pointer;">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Login Link (Logged Out) -->
                <a *ngIf="!auth.isLoggedIn()" (click)="openAuthModal('login')"
                    class="text-decoration-none text-dark cursor-pointer">
                    Login
                </a>

            </nav>
        </div>
    </div>
</header>

<main class="app-main">
    <div class="app-container">
        <router-outlet></router-outlet>

        <!-- Auth Modal -->
        <app-auth-modal></app-auth-modal>

        <!-- Global Loader -->
        <app-loader></app-loader>

        <!-- Toast Notifications -->
        <p-toast position="top-right"></p-toast>

        <!-- Promotional Modal -->
        <app-promo-modal></app-promo-modal>
    </div>
</main>

<app-footer></app-footer>