<p-toast></p-toast>

<div class="upload-page">
  <div class="upload-container">
    <div class="upload-header">
      <button class="btn-back" (click)="cancel()">
        <i class="bi bi-arrow-left"></i>
        Back
      </button>
      <h1 class="page-title">
        <i class="bi bi-cloud-upload"></i>
        Upload Prescription
      </h1>
      <p class="page-subtitle">Upload prescription for yourself or family members</p>
    </div>

    <div class="upload-form">
      <!-- File Upload Area -->
      <div class="upload-section">
        <label class="section-label">Prescription Image/PDF</label>
        
        <div 
          class="dropzone"
          [class.drag-over]="dragOver"
          [class.has-file]="selectedFile"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)"
          (click)="fileInput.click()">
          
          <input 
            #fileInput
            type="file" 
            accept="image/jpeg,image/jpg,image/png,application/pdf"
            (change)="onFileSelected($event)"
            style="display: none">

          <div *ngIf="!selectedFile" class="dropzone-content">
            <i class="bi bi-cloud-upload-fill"></i>
            <h3>Drag & Drop or Click to Upload</h3>
            <p>Supports: JPG, PNG, PDF (Max 5MB)</p>
          </div>

          <div *ngIf="selectedFile && previewUrl" class="preview-container">
            <img [src]="previewUrl" alt="Preview">
            <button class="btn-remove" (click)="removeFile(); $event.stopPropagation()">
              <i class="bi bi-x-circle-fill"></i>
            </button>
          </div>

          <div *ngIf="selectedFile && !previewUrl" class="file-info">
            <i class="bi bi-file-earmark-pdf-fill"></i>
            <div class="file-details">
              <p class="file-name">{{selectedFile.name}}</p>
              <p class="file-size">{{(selectedFile.size / 1024 / 1024).toFixed(2)}} MB</p>
            </div>
            <button class="btn-remove" (click)="removeFile(); $event.stopPropagation()">
              <i class="bi bi-x-circle-fill"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Form Fields -->
      <div class="form-section">
        <div class="form-group">
          <label class="form-label">
            <i class="bi bi-person"></i>
            Family Member Name *
          </label>
          <input 
            type="text" 
            class="form-control" 
            [(ngModel)]="familyMemberName"
            placeholder="e.g., Self, John Doe, Mother"
            [disabled]="uploading">
        </div>

        <div class="form-group">
          <label class="form-label">
            <i class="bi bi-calendar-x"></i>
            Expiry Date (Optional)
          </label>
          <p-calendar 
            [(ngModel)]="expiryDate"
            [minDate]="minDate"
            dateFormat="dd/mm/yy"
            [showIcon]="false"
            placeholder="Select expiry date"
            styleClass="custom-calendar"
            inputStyleClass="form-control"
            [disabled]="uploading">
          </p-calendar>
        </div>
      </div>

      <!-- Upload Progress -->
      <div *ngIf="uploading" class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="uploadProgress"></div>
        </div>
        <p class="progress-text">Uploading... {{uploadProgress}}%</p>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn-cancel" (click)="cancel()" [disabled]="uploading">
          Cancel
        </button>
        <button class="btn-upload" (click)="uploadPrescription()" [disabled]="uploading || !selectedFile">
          <i class="bi bi-cloud-upload"></i>
          {{uploading ? 'Uploading...' : 'Upload Prescription'}}
        </button>
      </div>
    </div>
  </div>
</div>
