<div class="appointments-page" [@fadeIn]>
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="bi bi-calendar-check"></i>
        My Appointments
      </h1>
      <p class="page-subtitle">View and manage all your eye care appointments</p>
    </div>
  </div>

  <div class="appointments-container">
    <div class="appointments-card">
      
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading your appointments...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-state">
        <i class="bi bi-exclamation-triangle"></i>
        <p>{{error}}</p>
        <button class="btn-retry" (click)="loadAppointments()">Try Again</button>
      </div>

      <!-- Appointments Table -->
      <div *ngIf="!loading && !error">
        <p-table 
          [value]="appointments" 
          responsiveLayout="scroll" 
          styleClass="appointments-table"
          [paginator]="appointments.length > 10"
          [rows]="10">
          
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="appointmentDate">
                <div class="header-cell">
                  <i class="bi bi-calendar3"></i>
                  Date
                  <p-sortIcon field="appointmentDate"></p-sortIcon>
                </div>
              </th>
              <th>
                <div class="header-cell">
                  <i class="bi bi-clock"></i>
                  Time
                </div>
              </th>
              <th>
                <div class="header-cell">
                  <i class="bi bi-card-text"></i>
                  Purpose
                </div>
              </th>
              <th>
                <div class="header-cell">
                  <i class="bi bi-info-circle"></i>
                  Status
                </div>
              </th>
              <th>
                <div class="header-cell">
                  <i class="bi bi-gear"></i>
                  Actions
                </div>
              </th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-appointment>
            <tr class="appointment-row">
              <td>
                <div class="date-cell">
                  <span class="date-main">{{appointment.appointmentDate | date:'MMM d, y'}}</span>
                  <span class="date-day">{{appointment.appointmentDate | date:'EEEE'}}</span>
                </div>
              </td>
              <td>
                <div class="time-cell">
                  <i class="bi bi-clock-fill"></i>
                  {{appointment.appointmentTime}}
                </div>
              </td>
              <td>
                <div class="purpose-cell">
                  {{appointment.purpose}}
                </div>
              </td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(appointment.status)">
                  {{appointment.status}}
                </span>
              </td>
              <td>
                <button class="btn-view" (click)="viewDetails(appointment)">
                  <i class="bi bi-eye"></i>
                  View
                </button>
              </td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="4">
                <div class="empty-state">
                  <i class="bi bi-calendar-x"></i>
                  <h3>No Appointments Yet</h3>
                  <p>You haven't booked any appointments. Book your first eye test today!</p>
                  <a routerLink="/appointment" class="btn-book">
                    <i class="bi bi-plus-circle"></i>
                    Book Appointment
                  </a>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>

  <!-- Appointment Details Modal -->
  <div class="modal-overlay" *ngIf="selectedAppointment" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()" [@fadeIn]>
      <div class="modal-header">
        <h2>
          <i class="bi bi-calendar-check-fill"></i>
          Appointment Details
        </h2>
        <button class="btn-close" (click)="closeDetails()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="detail-grid">
          <div class="detail-item">
            <div class="detail-label">
              <i class="bi bi-calendar3"></i>
              Appointment Date
            </div>
            <div class="detail-value">
              {{selectedAppointment.appointmentDate | date:'fullDate'}}
            </div>
          </div>

          <div class="detail-item">
            <div class="detail-label">
              <i class="bi bi-clock"></i>
              Appointment Time
            </div>
            <div class="detail-value">
              {{selectedAppointment.appointmentTime}}
            </div>
          </div>

          <div class="detail-item">
            <div class="detail-label">
              <i class="bi bi-card-text"></i>
              Purpose
            </div>
            <div class="detail-value">
              {{selectedAppointment.purpose}}
            </div>
          </div>

          <div class="detail-item">
            <div class="detail-label">
              <i class="bi bi-info-circle"></i>
              Status
            </div>
            <div class="detail-value">
              <span class="status-badge" [ngClass]="getStatusClass(selectedAppointment.status)">
                {{selectedAppointment.status}}
              </span>
            </div>
          </div>

          <div class="detail-item" *ngIf="selectedAppointment.user">
            <div class="detail-label">
              <i class="bi bi-person"></i>
              Patient Name
            </div>
            <div class="detail-value">
              {{selectedAppointment.user.firstName}} {{selectedAppointment.user.lastName}}
            </div>
          </div>

          <div class="detail-item" *ngIf="selectedAppointment.user">
            <div class="detail-label">
              <i class="bi bi-envelope"></i>
              Email
            </div>
            <div class="detail-value">
              {{selectedAppointment.user.email}}
            </div>
          </div>

          <div class="detail-item" *ngIf="selectedAppointment.user?.mobileNumber">
            <div class="detail-label">
              <i class="bi bi-telephone"></i>
              Mobile Number
            </div>
            <div class="detail-value">
              {{selectedAppointment.user.mobileNumber}}
            </div>
          </div>

          <div class="detail-item">
            <div class="detail-label">
              <i class="bi bi-hash"></i>
              Appointment ID
            </div>
            <div class="detail-value">
              #{{selectedAppointment.id}}
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-modal-close" (click)="closeDetails()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
