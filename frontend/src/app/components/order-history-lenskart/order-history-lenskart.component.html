<div class="order-history-container">
  <h1>Order History</h1>

  <div *ngIf="isLoading" class="loading">
    <p>Loading orders...</p>
  </div>

  <div *ngIf="!isLoading && orders && orders.length > 0" class="orders-list">
    <div class="order-card" *ngFor="let order of orders">
      <div class="order-header" (click)="selectOrder(order)">
        <div class="order-info">
          <h3>Order #{{ order.orderNumber || order.id }}</h3>
          <p class="order-date">{{ formatDate(order.orderDate || order.createdAt) }}</p>
        </div>
        <div class="order-status">
          <span class="status-badge" [style.backgroundColor]="getStatusColor(order.status)">
            {{ order.status | titlecase }}
          </span>
        </div>
        <div class="order-total">
          <p class="price">₹{{ order.totalAmount | number:'1.0-0' }}</p>
          <p class="items-count">{{ order.orderItems?.length || 0 }} items</p>
        </div>
        <div class="toggle-icon">
          <span *ngIf="selectedOrder?.id !== order.id">▼</span>
          <span *ngIf="selectedOrder?.id === order.id">▲</span>
        </div>
      </div>

      <div *ngIf="selectedOrder?.id === order.id" class="order-details">
        <!-- Items Section -->
        <div class="details-section">
          <h4>Order Items</h4>
          <div class="items-table">
            <div class="item-row" *ngFor="let item of order.orderItems">
              <div class="item-info">
                <img *ngIf="item.product?.imageUrl" [src]="item.product.imageUrl" [alt]="item.product.name"
                  class="item-image">
                <div class="item-details">
                  <p class="item-name">{{ item.product.name }}</p>
                  <p class="item-qty">Qty: {{ item.quantity }}</p>
                </div>
              </div>
              <div class="item-price">
                <p>₹{{ item.unitPrice | number:'1.0-0' }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Shipping Section -->
        <div class="details-section">
          <h4>Shipping Address</h4>
          <div class="address-info">
            <p>{{ order.shippingAddress }}</p>
          </div>
        </div>

        <!-- Price Breakdown Section -->
        <div class="details-section">
          <h4>Price Breakdown</h4>
          <div class="price-breakdown">
            <div class="breakdown-row">
              <span>Subtotal:</span>
              <span>₹{{ order.totalAmount | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-row total">
              <span>Total:</span>
              <span>₹{{ order.totalAmount | number:'1.0-0' }}</span>
            </div>
          </div>
        </div>

        <!-- Payment & Tracking -->
        <div class="details-section">
          <div class="section-row">
            <div>
              <h4>Payment Method</h4>
              <p>{{ order.paymentMethod }}</p>
            </div>
            <div>
              <h4>Tracking Number</h4>
              <p>{{ order.trackingNumber || 'Not available yet' }}</p>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="details-section actions">
          <button class="btn btn-secondary" *ngIf="order.status !== 'cancelled' && order.status !== 'delivered'">
            Track Order
          </button>
          <button class="btn btn-danger" *ngIf="order.status === 'pending'" (click)="cancelOrder(order.id)">
            Cancel Order
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading && (!orders || orders.length === 0)" class="empty-orders">
    <p>No orders found</p>
    <button class="btn btn-primary" routerLink="/products">
      Start Shopping
    </button>
  </div>
</div>